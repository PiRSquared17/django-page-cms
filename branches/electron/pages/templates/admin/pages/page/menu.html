{% load pages_tags i18n adminmedia cache %}

{% if has_permission %}
    <tr id="page-row-{{ page.id }}" class="child-of-{{ page.parent_id }}">
        <th class="title-cell">
            <div class="title-cell-container" style="margin-left:{{ page.margin_level }}em">
                {% if page.children.count %}
                    <a href="#" class="expand-collapse {% if expanded %}expanded{% endif %}" id="c{{ page.id }}">
                        <span class="expand">+</span>
                        <span class="collapse">-</span>
                        <img class="expand-loading" src="/media/pages/images/loading.gif" alt="loading" />
                    </a>
                {% endif %} 
                <a href="{{ url }}{{ page.id }}/" class="changelink">{% show_content page "slug" %}</a>
                
                <ul class="translation">
                    {% for lang in page.get_languages %} 
                        <li class="{% if not forloop.last %}last{% endif %}">
                            <a href="{{ url }}{{ page.id }}/?language={{ lang }}" class="changelink">{{ lang }}</a>
                        </li>
                    {% endfor %}
                </ul>
                
                <div id="move-target-{{ page.id }}" class="insert container">
                    <a href="#" class="move-target left"><span>{% trans "insert above" %}</span></a>
                    <a href="#" class="move-target right"><span>{% trans "insert below" %}</span></a>
                    <a href="#" class="move-target first-child"><span>{% trans "insert as child" %}</span></a>
                </div>
            </div>
        </th>
        <td class="action-cell">
            <a class="viewlink" href="{{ page.get_absolute_url }}" target="_blank">{% trans "view" %}</a> |
            <a class="movelink" id="move-link-{{ page.id }}" href="#">{% trans "move" %}</a> |
            <a class="addlink" id="add-link-{{ page.id }}" href="#">{% trans "add" %}</a> |
            <a class="deletelink" href="{{ page.id }}/delete/">{% trans "delete" %}</a>
        </td>
        <td class="publish-cell">
            {% ifequal page.status page.DRAFT %}
                <img src="/media/pages/images/icons/draft.gif" alt="draft" />
            {% else %}{% ifequal page.status page.PUBLISHED %}
                <img src="/media/pages/images/icons/published.gif" alt="published" />
            {% else %}
                <img src="/media/pages/images/icons/hidden.gif" alt="hidden"/>
            {% endifequal %}{% endifequal %}
            &nbsp;
            <select class="publish-select" name="select-status-{{ page.id }}">
                <option value="0" {% ifequal page.status page.DRAFT %}selected="selected"{% endifequal %}>{% trans "Draft" %}</option>
                <option value="1" {% ifequal page.status page.PUBLISHED %}selected="selected"{% endifequal %}>{% trans "In navigation" %}</option>
                <option value="3" {% ifequal page.status page.HIDDEN %}selected="selected"{% endifequal %}>{% trans "Hidden" %}</option>
            </select>
        </td>
        <td class="template-cell">
            {{ page.get_template_name }}
        </td>
        <td class="author-cell">
            {% cache 10000 page_author page.author_id %}
                {% firstof page.author.get_full_name page.author.first_name page.author.username %}
            {% endcache %}
        </td>
    </tr>
{% endif %}

{% if expanded %}
    {% for child in page.children.all %}
        {% pages_admin_menu child url level %}
    {% endfor %}
{% endif %}
