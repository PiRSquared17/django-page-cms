{% load pages_tags i18n adminmedia cache %}

{% if has_permission %}
    <tr id="page-row-{{ page.id }}" class="child-of-{{ page.parent_id }}">
        <th class="title-cell">
            <div class="title-cell-container" style="margin-left:{{ page.margin_level }}em">
                {% if page.children.count %}
                    <a href="#" class="expand-collapse {% if expanded %}expanded{% endif %}" id="c{{ page.id }}">
                        <span class="expand">+</span>
                        <span class="collapse">-</span>
                        <img class="expand-loading" src="/media/pages/images/loading.gif" alt="loading" />
                    </a>
                {% endif %} 
                <a href="{{ url }}{{ page.id }}/" class="title changelink">{% show_content page "slug" %}</a>
                
                
                <div class="actions popup">
                    <a class="viewlink" href="{{ page.get_absolute_url }}" target="_blank"><span class="help">{% trans "view this page" %}</span></a>
                    <a class="movelink" id="move-link-{{ page.id }}" href="#"><span class="help">{% trans "move this page" %}</span></a>
                    <a class="addlink" id="add-link-{{ page.id }}" href="#"><span class="help">{% trans "insert a new page here" %}</span></a>
                    <a class="deletelink" href="{{ page.id }}/delete/"><span class="help">{% trans "delete this page" %}</span></a>
                    <a class="cancellink popup" href="#">{% trans "cancel" %}<span class="help">{% trans "don&#x27;t move this page" %}</span></a>
                </div>
                
                <div id="move-target-{{ page.id }}" class="insert popup container">
                    <a class="cancellink popup" href="#">{% trans "cancel" %}<span class="help">{% trans "don&#x27;t insert a new page here" %}</span></a>
                    <a href="#" class="move-target left"><span class="help">{% trans "insert above" %}</span></a>
                    <a href="#" class="move-target right"><span class="help">{% trans "insert below" %}</span></a>
                    <a href="#" class="move-target first-child"><span class="help">{% trans "insert as child" %}</span></a>
                </div>
            </div>
        </th>
        <td class="language-cell">
            <ul class="popup">
                {% for lang in page.get_languages %}<li class="{% if not forloop.last %}last{% endif %}"><a href="{{ url }}{{ page.id }}/?language={{ lang }}" class="changelink">{{ lang }}<span class="help">{% trans "edit the page in this language" %}</span></a></li>{% endfor %}
            </ul>
        </td>
        <td class="publish-cell">
            {% ifequal page.status page.DRAFT %}
                <img src="/media/pages/images/icons/draft.gif" alt="draft" />
            {% else %}{% ifequal page.status page.PUBLISHED %}
                <img src="/media/pages/images/icons/published.gif" alt="published" />
            {% else %}
                <img src="/media/pages/images/icons/hidden.gif" alt="hidden"/>
            {% endifequal %}{% endifequal %}
            &nbsp;
            <select class="publish-select" name="select-status-{{ page.id }}">
                <option value="0" {% ifequal page.status page.DRAFT %}selected="selected"{% endifequal %}>{% trans "Draft" %}</option>
                <option value="1" {% ifequal page.status page.PUBLISHED %}selected="selected"{% endifequal %}>{% trans "In navigation" %}</option>
                <option value="3" {% ifequal page.status page.HIDDEN %}selected="selected"{% endifequal %}>{% trans "Hidden" %}</option>
            </select>
        </td>
        <td class="template-cell">
            {{ page.get_template_name }}
        </td>
        <td class="author-cell">
            {% cache 10000 page_author page.author_id %}
                {% firstof page.author.get_full_name page.author.first_name page.author.username %}
            {% endcache %}
        </td>
    </tr>
{% endif %}

{% if expanded %}
    {% for child in page.children.all %}
        {% pages_admin_menu child url level %}
    {% endfor %}
{% endif %}
